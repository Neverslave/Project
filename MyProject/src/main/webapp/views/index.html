<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <title>excel拆分</title>
    <link rel="stylesheet" href="/assets/layui/layui.css">
    <script src="/assets/layui/layui.all.js"></script>
</head>
<body>
<h1>excel 导入</h1>

<div class="layui-upload">
    <button type="button" class="layui-btn layui-btn-normal" id="upload">选择文件</button>
    <button type="button" class="layui-btn" id="startUpload">开始上传</button>
</div>
<div class="layui-progress">
    <div class="layui-progress-bar" lay-percent="10%"></div>
</div>
</body>

<script>

    //创建监听函数
    var xhrOnProgress=function(fun) {
        xhrOnProgress.onprogress = fun; //绑定监听
        //使用闭包实现监听绑
        return function() {
            //通过$.ajaxSettings.xhr();获得XMLHttpRequest对象
            var xhr = $.ajaxSettings.xhr();
            //判断监听函数是否为函数
            if (typeof xhrOnProgress.onprogress !== 'function')
                return xhr;
            //如果有监听函数并且xhr对象支持绑定时就把监听函数绑定上去
            if (xhrOnProgress.onprogress && xhr.upload) {
                xhr.upload.onprogress = xhrOnProgress.onprogress;
            }
            return xhr;
        }
    }
    layui.use(['upload','element'], function() {
        var $ = layui.jquery
            , upload = layui.upload
            ,element = layui.element;
        //选完文件后不自动上传
        upload.render({
            elem: '#upload'
            , url: '/upload/'
            , auto: false
            //,multiple: true
            , bindAction: '#startUpload'
            ,xhr:xhrOnProgress
            ,progress: function(index,value){//上传进度回调 value进度值
            element.progress('image'+index, value+'%');//设置页面进度条
        }
            , done: function (res) {
                console.log(res)
            }
        });

    })


</script>


</html>